"use strict";

(function (app, core, CONSTANTS) {
  app.FacebookPixel = class FacebookPixel {
    constructor(container) {
      this.container = container;
      this.embedCode = this.container.dataset.embedCode;
      const cookiePolicyChosen = core.localStorage.getStorage('cookie-policy-chosen', true);
      this.dropPixelCode(cookiePolicyChosen === 'true');
      window.addEventListener(CONSTANTS.EVENTS.COOKIES.ACCEPTED, event => {
        this.dropPixelCode(event.detail === 'all');
      });
    }

    /**
     * IF the value of consent is true, the Facebook Pixel tracking code is run
     * @param {Boolean} consent - Whether the user has consented to Facebook tracking or not
     */
    dropPixelCode(consent) {
      this.container.innerHTML = consent ? this.embedCode : '';
    }
  };
  app.widgetInitialiser.addWidget('facebook-pixel', app.FacebookPixel);
})(PULSE.app, PULSE.core, PULSE.app.common.CONSTANTS);