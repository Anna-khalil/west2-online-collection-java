"use strict";

(function (app, common) {
  const DATE_SELECTOR = {
    DATES: '.js-comp-dates',
    DATE_FROM: '.js-date-from',
    DATE_TO: '.js-date-to'
  };
  app.FormatCompDates = class FormatCompDates {
    /**
    * FormatDates
    *
    * @param { HTMLElement } container - container Element that widget is instantiated on
    */
    constructor(container) {
      const dateEls = [].slice.call(container.querySelectorAll(DATE_SELECTOR.DATES));
      dateEls.forEach(this.format.bind(this));
    }

    /**
     * Format
     *
     * Formats dates depending on whether the comp is single day, multiple days across a single month
     * or multiple days spanning multiple months
     *
     * @param { HTMLElement } element - element that contains the dates to be formatted
     */
    format(element) {
      const dateFrom = element.querySelector(DATE_SELECTOR.DATE_FROM);
      const dateTo = element.querySelector(DATE_SELECTOR.DATE_TO);
      const longDate = element.getAttribute('data-long-date') === 'true';
      let compDates = common.date.formatCompDates(dateFrom.dataset.date, dateTo.dataset.date, longDate);
      element.innerHTML = compDates;
    }
  };

  // initialise on article pages
  app.widgetInitialiser.addMultipleWidgetsByName('format-comp-dates', app.FormatCompDates);
})(PULSE.app, PULSE.app.common);